(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{285:function(s,t,a){"use strict";a.r(t);var e=a(14),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"frontmatter-title"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#frontmatter-title"}},[s._v("#")]),s._v(" "+s._s(s.$frontmatter.title))]),s._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#安装"}},[s._v("安装")])]),a("li",[a("a",{attrs:{href:"#升级"}},[s._v("升级")])]),a("li",[a("a",{attrs:{href:"#手动下载charts"}},[s._v("手动下载charts")])]),a("li",[a("a",{attrs:{href:"#参数说明"}},[s._v("参数说明")])]),a("li",[a("a",{attrs:{href:"#卸载"}},[s._v("卸载")])])])]),a("p"),s._v(" "),a("p",[s._v("Etcd-Carry支持通过helm 3.x进行安装，helm的安装包你可以从"),a("a",{attrs:{href:"https://github.com/helm/helm/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("这里"),a("OutboundLink")],1),s._v("获取。")]),s._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("p",[s._v("Etcd-Carry的helm仓库地址为：https://etcd-carry.github.io/helm-chart/")]),s._v(" "),a("ol",[a("li",[s._v("添加helm仓库")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ helm repo "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" etcd-carry https://etcd-carry.github.io/helm-chart/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("查看是否添加成功")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ helm repo list\nNAME      \tURL                                     \netcd-carry\thttps://etcd-carry.github.io/helm-chart/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("查看仓库中chart包列表")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ helm search repo\nNAME                 \tCHART VERSION\tAPP VERSION\tDESCRIPTION                \netcd-carry/etcd-carry\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v(".0        \tv0.2.0     \tA Helm chart "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" Kubernetes\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("Etcd-Carry安装前需要指定源etcd集群和目的etcd集群的证书密钥；如果你想自定义过滤规则同步k8s数据，还需要配置好规则。")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 按照下面的文件命名来保存密钥信息和过滤规则：")]),s._v("\nsource-ca.crt "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 源集群SSL CA文件\nsource-server.crt "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 源集群SSL证书文件\nsource-server.key "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 源集群SSL密钥文件\ndest-ca.crt "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 目的集群SSL CA文件\ndest-server.crt "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 目的集群SSL证书文件\ndest-server.key "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 目的集群SSL密钥文件\nrules.yaml "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 过滤规则文件\nsecrets-encryption.yaml "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" etcd加密存储k8s secrets的加密算法文件\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 准备好证书密钥及配置文件后，下载kustomization.yaml文件到同一目录下")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-LO")]),s._v(" https://github.com/etcd-carry/etcd-carry/releases/download/v0.2.0/kustomization.yaml\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑kustomization.yaml")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" kustomization.yaml\nconfigMapGenerator:\n- name: etcd-carry-pki  // 证书密钥configmap\n  files:\n  - source-ca.crt\n  - source-server.crt\n  - source-server.key\n  - dest-ca.crt\n  - dest-server.crt\n  - dest-server.key\n- name: etcd-carry-config  // "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("可选"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("配置文件configmap,包括过滤规则和secrets加密算法文件"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("若不配置则删除\n  files:\n  - rules.yaml\n  - secrets-encryption.yaml\ngeneratorOptions:\n  disableNameSuffixHash: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成证书密钥和配置文件的Configmap")]),s._v("\n$ kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-k")]),s._v(" ./ "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--namespace")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br")])]),a("ol",{attrs:{start:"5"}},[a("li",[s._v("安装")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("helm "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" etcd-carry etcd-carry/etcd-carry "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.2")]),s._v(".0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--namespace")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("endpoints.source")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".48.11:2379,endpoints.dest"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".48.22:2379,existingPkiConfigmap"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("etcd-carry-pki\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"升级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#升级"}},[s._v("#")]),s._v(" 升级")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加仓库地址")]),s._v("\n$ helm repo "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" etcd-carry https://etcd-carry.github.io/helm-chart/\n\n$ helm repo update\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 升级到指定版本")]),s._v("\n$ helm upgrade etcd-carry etcd-carry/etcd-carry "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v(".0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("--force"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),a("p",[s._v("升级前，请阅读Change Log确保你了解新版本中的重大变化")])]),s._v(" "),a("h2",{attrs:{id:"手动下载charts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手动下载charts"}},[s._v("#")]),s._v(" 手动下载charts")]),s._v(" "),a("p",[s._v("如果你的环境无法访问"),a("code",[s._v("https://etcd-carry.github.io/helm-chart/")]),s._v("的话，你可以从"),a("a",{attrs:{href:"https://github.com/etcd-carry/helm-chart/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("这里"),a("OutboundLink")],1),s._v("把chart下载到本地进行安装或升级")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ helm install/upgrade etcd-carry /"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v("/TO/CHART\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"参数说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参数说明"}},[s._v("#")]),s._v(" 参数说明")]),s._v(" "),a("p",[s._v("Etcd-Carry安装时的一些参数需要根据实际的场景进行设置，参数说明如下：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[a("strong",[s._v("参数")])]),s._v(" "),a("th",[a("strong",[s._v("描述")])]),s._v(" "),a("th",[a("strong",[s._v("默认值")])])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("replicaCount")]),s._v(" "),a("td",[s._v("Etcd-Carry deployment的副本数")]),s._v(" "),a("td",[s._v("1")])]),s._v(" "),a("tr",[a("td",[s._v("image.repository")]),s._v(" "),a("td",[s._v("Etcd-Carry镜像仓库")]),s._v(" "),a("td",[s._v("xakdwch5/etcd-carry")])]),s._v(" "),a("tr",[a("td",[s._v("image.tag")]),s._v(" "),a("td",[s._v("Etcd-Carry镜像tag")]),s._v(" "),a("td",[s._v("latest")])]),s._v(" "),a("tr",[a("td",[s._v("image.pullPolicy")]),s._v(" "),a("td",[s._v("Etcd-Carry镜像拉取策略")]),s._v(" "),a("td",[s._v("IfNotPresent")])]),s._v(" "),a("tr",[a("td",[s._v("imagePullSecrets")]),s._v(" "),a("td",[s._v("Etcd-Carry的 image pull secrets 列表")]),s._v(" "),a("td",[s._v("[]")])]),s._v(" "),a("tr",[a("td",[s._v("existingPkiConfigmap")]),s._v(" "),a("td",[s._v("安装前已存在的证书密钥configmap")]),s._v(" "),a("td")]),s._v(" "),a("tr",[a("td",[s._v("existingConfigmap")]),s._v(" "),a("td",[s._v("安装前已存在的配置文件configmap")]),s._v(" "),a("td")]),s._v(" "),a("tr",[a("td",[s._v("endpoints.source")]),s._v(" "),a("td",[s._v("源etcd集群的ip:端口")]),s._v(" "),a("td")]),s._v(" "),a("tr",[a("td",[s._v("endpoints.dest")]),s._v(" "),a("td",[s._v("目的etcd集群的ip:端口")]),s._v(" "),a("td")]),s._v(" "),a("tr",[a("td",[s._v("resources")]),s._v(" "),a("td",[s._v("Etcd-Carry的limit、request资源")]),s._v(" "),a("td",[s._v("{}")])]),s._v(" "),a("tr",[a("td",[s._v("nodeSelector")]),s._v(" "),a("td",[s._v("Etcd-Carry部署的 node selector 亲和性")]),s._v(" "),a("td",[s._v("{}")])]),s._v(" "),a("tr",[a("td",[s._v("tolerations")]),s._v(" "),a("td",[s._v("Etcd-Carry部署的 tolerations")]),s._v(" "),a("td",[s._v("{}")])]),s._v(" "),a("tr",[a("td",[s._v("affinity")]),s._v(" "),a("td",[s._v("Etcd-Carry部署的affinity亲和性")]),s._v(" "),a("td",[s._v("{}")])])])]),s._v(" "),a("p",[s._v("这些参数可以通过 --set key=value[,key=value] 参数在 helm install 或 helm upgrade 命令中生效。")]),s._v(" "),a("h2",{attrs:{id:"卸载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#卸载"}},[s._v("#")]),s._v(" 卸载")]),s._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("卸载会删除Etcd-Carry的Deployment及关联的RS、Pod")])]),s._v(" "),a("p",[s._v("卸载使用helm chart安装的Etcd-Carry:")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ helm uninstall etcd-carry "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\nrelease "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd-carry"')]),s._v(" uninstalled\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])])}),[],!1,null,null,null);t.default=r.exports}}]);